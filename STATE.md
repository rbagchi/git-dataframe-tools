## Current State of Runbook Test Implementation

**Goal:** Add tests that run the commands in the `RUNBOOK-git2df.md` and `README.md` and checks the output.

**Progress:**
- Created new test files `tests/test_runbook.py` and `tests/test_readme.py`.
- Modified the tests to extract `bash` code blocks from `RUNBOOK-git2df.md` and `README.md`.
- The tests run the extracted code blocks using `subprocess.run`.
- The tests set the `PYTHONPATH` environment variable to include the project root.
- The tests create a temporary git repository for the code to run against.

**Test Suite Improvement Plan Progress (from TEST-IMPROVEMENT-PLAN.md):**
- **1. Consolidate Git Repository Setup with a `pytest` Fixture:**
    - Created `tests/conftest.py` and added a `git_repo` fixture for general Git repository setup.
    - Refactored `tests/test_git_integration.py` to use the new `git_repo` fixture for `test_get_git_log_data_integration_default`, replacing manual setup.
- **2. Refactor `dulwich` Backend Tests to Use a Real Repository:**
    - Added a `dulwich_repo` fixture and `_create_dulwich_commit` helper to `tests/conftest.py` for `dulwich` repository setup.
    - Started refactoring `tests/test_git2df_dulwich_backend.py` to use the `dulwich_repo` fixture and real `dulwich` objects, replacing extensive mocking. This is still in progress.

**Current Blockers/Issues:**
- `tests/test_git2df_dulwich_backend.py` tests are currently failing with `dulwich.errors.GitProtocolError: No host specified.`. This occurs because `DulwichRemoteBackend` is attempting to fetch from a remote URL, but it's being provided with a local path. The `DulwichRemoteBackend` expects a valid HTTP/HTTPS URL for remote operations, but the tests are setting up a local `dulwich` repository.
- The remaining failing tests (from the original runbook tests) are primarily due to a mismatch in the output format generated by `src/git2df/dulwich_backend.py` and the input format expected by `src/git2df/git_parser.py`.

## Next Steps

1.  Address the `dulwich.errors.GitProtocolError: No host specified.` by either:
    - Modifying `DulwichRemoteBackend` to handle local repository paths directly.
    - Mocking `HttpGitClient` within `DulwichRemoteBackend` to prevent actual network requests when a local path is provided.
2.  Address the output format mismatch between `src/git2df/dulwich_backend.py` and `src/git2df/git_parser.py`.
3.  Systematically address other failing tests.